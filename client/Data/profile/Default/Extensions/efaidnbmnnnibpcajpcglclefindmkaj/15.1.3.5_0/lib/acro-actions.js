/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
function dependOn(){"use strict";return[require("communicate"),require("common"),require("util"),require("proxy"),require("analytics"),require("acro-web2pdf")]}var def;require=function(e){"use strict";return e},def=window.define?window.define:function(e,n){"use strict";return n.apply(null,[{ajax:$.ajax.bind($)}])};var exports=acom_analytics={};def(dependOn(),(function(e,n,t,o,r,i){"use strict";var a,s=null;for(a in s||(s=new function(){this.proxy=o.proxy.bind(this),this.LOG=n.LOG,this.getVersion=function(n){var o,a=function(i){if(i){if(clearTimeout(o),i.fillnSignEnabled&&"true"===i.fillnSignEnabled?SETTINGS.FILL_N_SIGN_ENABLED=!0:SETTINGS.FILL_N_SIGN_ENABLED=!1,i.frictionlessEnabled&&"false"===i.frictionlessEnabled&&(SETTINGS.FRICTIONLESS_ENABLED=!1),"true"===i.sharePointEnabled){if(SETTINGS.SHAREPOINT_ENABLED=!0,i.sharePointUrlString){let n=i.sharePointUrlString;if(n.length>0&&n.length<5e3){let t=n.split("|"),o=new Set;t.forEach(e=>{if(e.length>0)try{let n=new URL(e);o.add(n.origin)}catch(e){}}),e.setAllowListedSharePointUrls(o)}}}else SETTINGS.SHAREPOINT_ENABLED=!1;localStorage.setItem("isSharepointFeatureEnabled",SETTINGS.SHAREPOINT_ENABLED),i.optinState&&"false"===i.optinState?SETTINGS.ANALYTICS_OPT_IN=!1:1==+i.majorVersion?(r.event(r.e.SHIM_VERSION,{VERSION:"Unknown"}),r.shim="unknown"):0==+i.majorVersion?(r.event(r.e.SHIM_VERSION,{VERSION:"None"}),r.shim="none"):(r.event(r.e.SHIM_VERSION,{VERSION:i.majorVersion+"."+i.minorVersion}),r.shim=i.majorVersion+"."+i.minorVersion),e.setVersion(+i.majorVersion),1==i.isdummy&&t.setNMHConnectionStatus(!1),n(+i.majorVersion)}};o=setTimeout((function(){a({messageType:"shimVersionInfo",majorVersion:"1",minorVersion:"0",isdummy:!0})}),2e3),i.getVersion(a)},this.openInAcrobat=function(n,o,a){var s=this;return chrome.tabs.get(n.tabId,(function(o){if(o.url&&!/chrome\-extension/.test(o.url)&&(n.url=o.url),"pdfviewer"===n.click_context&&("FillnSign"===n.paramName?"SharePoint"===n.workflow_name?r.event(r.e.VIEWER_SHAREPOINT_FILLSIGN_CLICKED):r.event(r.e.VIEWER_FILLSIGN_CLICKED):"SharePoint"===n.workflow_name?r.event(r.e.VIEWER_SHAREPOINT_CLICKED):r.event(r.e.VIEWER_OPEN_IN_ACRO_CLICKED)),void 0===n.filename&&(n.filename=e.filenameFromUrl(n.url)),e.version>1){if(!0===n.isSharePointURL)return i.openInAcrobat(n),n.content_op="status",n.current_status="pdf_downloaded",e.sendMessage({tabId:n.tabId,loaded:n.loaded,filename:n.filename,url:n.url,persist:n.persist,version:n.version,start:n.start,is_pdf:n.is_pdf,newUI:n.newUI,panel_op:n.panel_op,content_op:n.content_op,current_status:"pdf_downloaded",isSharePointURL:n.isSharePointURL}),a&&a("OP_SUCCESS"),void("pdfviewer"===n.click_context&&("FillnSign"===n.paramName?r.event(r.e.VIEWER_SHAREPOINT_FILLSIGN_CLICKED_COMPLETE):r.event(r.e.VIEWER_SHAREPOINT_CLICKED_COMPLETE)));if(n.authenticatedPDF&&1==n.authenticatedPDF)return delete n.authenticatedPDF,"pdf_downloaded"===n.current_status&&n.base64PDF&&i.openInAcrobat(n),void e.sendMessage(n);n.panel_op="status",n.current_status="pdf_downloading",e.sendMessage(n);var l=t.newXHR();n.dataURL?l.open("GET",n.dataURL,!0):l.open("GET",n.url,!0),l.responseType="blob",l.onload=s.proxy((function(t){var o;l.status<400?"application/pdf"===l.response.type?((o=new FileReader).onloadend=function(t){n.base64PDF=t.target.result,i.openInAcrobat(n),n.content_op="status",n.current_status="pdf_downloaded",e.sendMessage({tabId:n.tabId,loaded:n.loaded,filename:n.filename,url:n.url,persist:n.persist,version:n.version,start:n.start,is_pdf:n.is_pdf,newUI:n.newUI,panel_op:n.panel_op,content_op:n.content_op,click_context:n.click_context,current_status:"pdf_downloaded"})},o.readAsDataURL(l.response),a&&a("OP_SUCCESS"),"pdfviewer"===n.click_context&&("FillnSign"===n.paramName?r.event(r.e.VIEWER_FILLSIGN_CLICKED_COMPLETE):r.event(r.e.VIEWER_OPEN_IN_ACRO_CLICKED_COMPLETE))):(n.authenticatedPDF=!0,e.sendMessage(n)):(n.panel_op="status",n.current_status="pdf_failure",e.sendMessage(n),"pdfviewer"===n.click_context&&("FillnSign"===n.paramName?r.event(r.e.VIEWER_FILLSIGN_CLICKED_FAILED):r.event(r.e.VIEWER_OPEN_IN_ACRO_CLICKED_FAILED)),a&&a("OP_FAILURE"))})),l.send()}else chrome.downloads.download({url:n.url,conflictAction:"uniquify"}),a&&a("APP_NOT_INSTALLED")})),!0},this.open_converted_file=function(e){i.openFile(e)}}),s)s.hasOwnProperty(a)&&("function"==typeof s[a]?exports[a]=s[a].bind(s):exports[a]=s[a]);return e.registerHandlers({open_in_acrobat:s.proxy(s.openInAcrobat),open_converted_file:s.proxy(s.open_converted_file)}),s}));
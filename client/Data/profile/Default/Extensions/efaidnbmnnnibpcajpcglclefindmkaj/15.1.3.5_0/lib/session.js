/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
function dependOn(){"use strict";return[require("util"),require("common"),require("proxy"),require("communicate"),require("analytics")]}var def;require=function(e){"use strict";return e},def=window.define?window.define:function(e,t){"use strict";return t.apply(null,[{ajax:$.ajax.bind($)}])};var exports=acom_analytics={};def(dependOn(),(function(e,t,o,n,r){"use strict";var s,i,a=null;const c={"cs-CZ":"https://www.adobe.com/cz/acrobat/","da-DK":"https://www.adobe.com/dk/acrobat/","de-DE":"https://www.adobe.com/de/acrobat/","en-US":"https://www.adobe.com/acrobat/","en-GB":"https://www.adobe.com/uk/acrobat/","es-ES":"https://www.adobe.com/es/acrobat/","fi-FI":"https://www.adobe.com/fi/acrobat/","fr-FR":"https://www.adobe.com/fr/acrobat/","it-IT":"https://www.adobe.com/it/acrobat/","ja-JP":"https://www.adobe.com/jp/acrobat/","ko-KR":"https://www.adobe.com/kr/acrobat/","nb-NO":"https://www.adobe.com/no/acrobat/","nl-NL":"https://www.adobe.com/nl/acrobat/","pl-PL":"https://www.adobe.com/pl/acrobat/","pt-BR":"https://www.adobe.com/br/acrobat/","ru-RU":"https://www.adobe.com/ru/acrobat/","sv-SE":"https://www.adobe.com/se/acrobat/","tr-TR":"https://www.adobe.com/tr/acrobat/","zh-TW":"https://www.adobe.com/tw/acrobat/"},d={edit_rotate:"online/rotate-pdf.html?",edit_delete:"online/delete-pdf-pages.html?",edit_reorder:"online/rearrange-pdf.html?",fillandsign:"online/sign-pdf.html?",request_signatures:"online/request-signature.html?",convert_pdf:"online/convert-pdf.html?",compress_pdf:"online/compress-pdf.html?",pdf_to_excel:"online/pdf-to-excel.html?",pdf_to_jpg:"online/pdf-to-jpg.html?",pdf_to_word:"online/pdf-to-word.html?",pdf_to_ppt:"online/pdf-to-ppt.html?"},l={edge:"x_api_client_id=edge_extension",chrome:"x_api_client_id=chrome_extension"},u={"cs-CZ":"https://documentcloud.adobe.com/cz/cs/","da-DK":"https://documentcloud.adobe.com/dk/da/","de-DE":"https://documentcloud.adobe.com/de/de/","en-US":"https://documentcloud.adobe.com/us/en/","en-GB":"https://documentcloud.adobe.com/gb/en/","es-ES":"https://documentcloud.adobe.com/es/es/","fi-FI":"https://documentcloud.adobe.com/fi/fi/","fr-FR":"https://documentcloud.adobe.com/fr/fr/","it-IT":"https://documentcloud.adobe.com/it/it/","ja-JP":"https://documentcloud.adobe.com/jp/ja/","ko-KR":"https://documentcloud.adobe.com/kr/ko/","nb-NO":"https://documentcloud.adobe.com/no/nb/","nl-NL":"https://documentcloud.adobe.com/nl/nl/","pl-PL":"https://documentcloud.adobe.com/pl/pl/","pt-BR":"https://documentcloud.adobe.com/br/pt/","ru-RU":"https://documentcloud.adobe.com/ru/ru/","sv-SE":"https://documentcloud.adobe.com/se/sv/","tr-TR":"https://documentcloud.adobe.com/tr/tr/","zh-TW":"https://documentcloud.adobe.com/tw/zh/"};for(s in function(){return n.getModule("upload")},i=function(){return n.getModule("convert-to-zip")},a||(a=new function(){var n,s,a;this.proxy=o.proxy.bind(this),this.LOG=t.LOG,this.updateName=function(n,r){if(!n||!r)return e.Deferred().resolve().promise();var s=t.settings.files_api+"assets/"+n+"/metadata/name",i=JSON.stringify({value:r,on_dup_name:"auto_rename"});return e.ajax({type:"PUT",url:s,data:i,headers:t.POST_headers()}).then((function(){}),this.proxy((function(e){o.REST_error(e,this,{url:s,data:i})})))},this.updateParent=function(n,r){if(!n||!r)return e.Deferred().resolve().promise();var s=t.settings.files_api+"assets/"+a.assetId+"/metadata/parent_id",i=JSON.stringify({value:r,on_dup_name:"auto_rename"});return e.ajax({type:"PUT",url:s,data:i,headers:t.POST_headers()}).then((function(){}),this.proxy((function(e){o.REST_error(e,this,{url:s,data:i})})))},this.rename=function(t){var o=e.Deferred();return this.updateName(t.assetId,t.filename).then(this.proxy((function(){this.updateParent(t.assetId,t.dest_folder).then((function(){o.resolve()}),(function(){o.reject()}))})),(function(){o.reject()})),o.promise()},this.gotoPath=function(o){var n=e.Deferred();a.userSelectPromise?a.userSelectPromise.then((function(){n.resolve()}),(function(){n.reject()})):n.resolve(),n.then(this.proxy((function(){t.sso_url(o).then(this.proxy((function(t){s?(e.isChrome()&&chrome.tabs.update(s,{url:t.uri,active:!0}),s=null):e.createTab(t.uri)})),this.proxy((function(n){o=t.settings.cloud_host+o,s?(e.isChrome()&&chrome.tabs.update(s,{url:o,active:!0}),s=null):e.createTab(o)})))})))},this.file_spec_done=function(e){a.dest_folder=e.dest_folder;var t=a.filename;"zip"!==t.substring(t.length-3,t.length)&&(a.filename=e.filename),a.upload_promise.then(this.proxy((function(){this.rename(a).then((function(){a.userSelectPromise.resolve()}),(function(){a.userSelectPromise.reject()}))})))},this.message=function(t,o,n){s&&e.sendMessage({tabId:s,progress_op:n?"set-error":"set-text",text:t,busy:o})},this.foundCode=function(e){var o=e.split("?")[1].split("=")[1].split("&")[0];this.newSession(null,!0),r.event(r.e.SIGN_IN_COMPLETE),t.authorize(o).then((function(){n&&n.resolve(),n=null}),(function(){n&&n.reject(),n=null}))},this.sessionRequest=function(e,t){(a=e).params=t||{filename:a.filename}},this.send_folders=function(){this.signed_in().then(this.proxy((function(){r.event(r.e.UPLOAD_RENAME_CLICKED),e.ajax({type:"POST",headers:t.POST_headers(),url:t.settings.files_api+"search",data:JSON.stringify({q:{object_type:"folder"},metadata:["id","name","created","parent_id"]})}).then(this.proxy((function(o){s&&(o.results.push({parent_id:null,object_type:"root",created:"2015-03-31T11:37:40",id:t.settings.files_root,name:"/"}),e.sendMessage({tabId:s,progress_op:"folders",folders:o.results}))})),this.proxy((function(e,t,n){o.REST_error(e,this)})))})))},this.newSession=function(t,o,n){n||(n=a.params),n.filename&&(a.userSelectPromise=e.Deferred()),t||(e.isChrome()&&(t=chrome.runtime.getURL("data/js/progress.html")+"#"+e.param(n)),n.filename&&this.send_folders()),s?e.isChrome()&&chrome.tabs.update(s,{url:t,active:!0}):(e.isChrome()&&chrome.tabs.create({url:t},this.proxy((function(e){o&&(s=e.id)}))),e.isFF()&&require("sdk/windows").browserWindows.open({url:t}))},this.sign_in=function(o,s){return n&&(n.reject(),n=null,r.event(r.e.SIGN_IN_ABANDONED)),n=e.Deferred(),t.baseUris().then(this.proxy((function(){var o={client_id:t.settings.ims_client_id,redirect_uri:t.settings.redirect_uri,scope:"AdobeID, skybox, openid",dc:!1},n=t.settings.ims_host+"ims/authorize/v1?"+e.param(o);r.event(r.e.SIGN_IN_SHOWN),this.newSession(n,!0)}))),n.promise()},this.signed_in=function(){return n||e.Deferred().resolve().promise()},this.signOut=function(){e.isChrome()&&chrome.tabs.create({url:t.settings.ims_host+"ims/logout/v1?"+e.param({access_token:t.settings.auth_token.replace(/Bearer /,""),client_id:t.settings.ims_client_id,client_secret:t.settings.ims_client_secret,redirect_uri:"https://adobe.com"})}),t.clearAuth()},this.checkSessionTab=function(e,t){e===s&&-1===t.indexOf("chrome-extension:")&&-1===t.indexOf(".adobe.com/")&&(s=null,n&&(n.reject(),n=null,r.event(r.e.SIGN_IN_ABANDONED)))},this.getFrictionlessURL=function(){var t="";return e&&e.getTranslation&&(t=e.getTranslation("web2pdfFrictionlessUrl")),""===t&&(t="https://www.adobe.com/go/fl_chromeext"),t},this.getAonlineURL=function(t){let o=t.locale,n=c[o],r=t.verb;if("acrobat_label"===r)return u[o]||"https://documentcloud.adobe.com";let s=d[r],i=e.isEdge()?"edge":"chrome",a=l[i];return n&&s?n+s+a:n?n+"online.html":s?"https://www.adobe.com/acrobat/"+s+a:"https://www.adobe.com/acrobat/online.html"},this.goto_acom=function(t){SETTINGS.USE_ACROBAT?e.createTab(this.getFrictionlessURL()):(this.sessionRequest(t,{}),this.gotoPath("files"))},this.go_to_aonline=function(t){e.createTab(this.getAonlineURL(t))},this.html_to_pdf=function(t,o){t.filename=o.tab.title.replace(/[\*"\/\\'&\.]/g,"")+".pdf",this.sessionRequest(t,{filename:t.filename,message:"Gathering HTML Content",busy:"true",progress_op:"htmlToPdf"}),this.sign_in(t,o).then(this.proxy((function(){e.isChrome()&&chrome.tabs.executeScript(t.tabId,{code:"var maxSize= "+SETTINGS.MAX_HTML_SIZE+", DEBUG = "+SETTINGS.DEBUG_MODE+", TABID = "+t.tabId+", OP = 'html-blob', EXCLUDE = [];",allFrames:!0},(function(){chrome.tabs.executeScript(t.tabId,{file:"data/js/get-html.js",allFrames:!0})}))})))},this.relay_message=function(t){t.complete?t.error?(e.consoleLog(t.error),r.event(r.e.HTML_SOURCE_SIZE_TOO_LARGE_ERROR)):(t.html_op="serialize_iframe",e.isChrome()&&chrome.tabs.executeScript(t.tabId,{code:"if (window.dc && window.OP) { receiveIframe("+JSON.stringify(t)+"); }",allFrames:!0})):e.isChrome()&&chrome.tabs.executeScript(t.tabId,{code:"if (window.dc && window.OP) {serialize("+JSON.stringify(t)+"); }",allFrames:!0})},this.flickr=function(e){this.sessionRequest(e,{}),this.newSession(null,!1,{unavailable:"flickr"})},this.error=function(t){if(s){a&&a.userSelectPromise&&a.userSelectPromise.reject();var o=["Please Report this Error:"];e.each(t,(function(e,t){o.push(e+": "+t)})),this.message(o.join("\n"),!1,!0),s=null}},o.handlers(this.error.bind(this)),e.isChrome()&&chrome.tabs.onRemoved.addListener((function(e){e===s&&(s=null,n&&(r.event(r.e.SIGN_IN_ABANDONED),n.reject(),n=null))})),this.html_blob=function(t){if(t.error)e.consoleError(t.error),r.logError(t.error,t.analytics[0]);else{r.logContents(t),r.checkAndLogHTMLBlobSize(t.blob.currentSize/1048576),t.analytics&&r.setParamsAndLogAnalytics(t.analytics,r.e.HTML_SOURCE_CONTENT,"content"),r.setArg("stage","CLONE"),r.checkAndLogTimingRange(t.cloneTiming),e.consoleLog("html blob send to:"+s);var o=JSON.stringify(t.blob);i().compress(o,a)}}},n.registerHandlers({goto_acom:a.proxy(a.goto_acom),go_to_aonline:a.proxy(a.go_to_aonline),html_to_pdf:a.proxy(a.html_to_pdf),flickr:a.proxy(a.flickr),file_spec_done:a.proxy(a.file_spec_done),"html-blob":a.proxy(a.html_blob),"relay-msg":a.proxy(a.relay_message)}),n.registerModule("session",a)),a)a.hasOwnProperty(s)&&("function"==typeof a[s]?exports[s]=a[s].bind(a):exports[s]=a[s]);return a}));
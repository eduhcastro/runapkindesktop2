/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
var $iframe,$newiframe,$fteIframe,disableKeyZoom,disableWheelZoom;const docUrl=document.location.href;function GetChromeMenuDimensions(e,t){const i=t.version>SETTINGS.READER_VER,o=t.version==SETTINGS.READER_VER,n=t.panel_op,r={width:0,height:0};if("trefoil"===e)switch(n){case"html_menu":case"status":case"test":i?(r.width=259,r.height=450):(r.width=294,r.height=565);break;case"pdf_menu":o?(r.width=294,r.height=350):i?(r.width=259,r.height=400):(r.width=294,r.height=145);break;case"load-frictionless":r.width=294,r.height=550}else"persistent"===e&&"pdf_menu"===n?SETTINGS.IS_BETA||!i?(r.width=350,r.height=280):i&&(r.width=200,r.height=50):"fte"===e&&(r.width=302,r.height=510);return r}function GetEdgeMenuDimensions(e,t){const i=t.version>SETTINGS.READER_VER,o=t.version==SETTINGS.READER_VER,n=t.panel_op,r={width:0,height:0};if("trefoil"===e)switch(n){case"html_menu":case"status":case"test":i?(r.width=259,r.height=450):(r.width=294,r.height=565);break;case"pdf_menu":o?(r.width=294,r.height=350):i?(r.width=259,r.height=400):(r.width=294,r.height=145);break;case"load-frictionless":r.width=294,r.height=550}else"persistent"===e&&"pdf_menu"===n?SETTINGS.IS_BETA||!i?(r.width=350,r.height=280):i&&(r.width=200,r.height=50):"fte"===e&&(r.width=302,r.height=530);return r}function GetMenuDimensions(e,t){return t.is_edge?GetEdgeMenuDimensions(e,t):GetChromeMenuDimensions(e,t)}function createAndInjectIframe(e){var t=e.base64PDF;delete e.base64PDF;let i="message="+encodeURIComponent(JSON.stringify(e));e.base64PDF=t;const o=GetMenuDimensions("trefoil",e);if(o.width<=0||o.height<=0)return;let n="block";"hidden"===e.frame_visibility&&(n="none"),($iframe=$("<iframe>")).attr("id","__acrobatDialog__").css({border:"0px","z-index":2147483647,position:"fixed",top:"-5px",right:"80px",width:o.width+"px",height:o.height+"px",display:n,margin:"auto"}).attr("src",chrome.extension.getURL("data/js/frame.html")+"?"+i).appendTo("html"),$(document).on("keydown",disableKeyZoom),$(document).on("mousewheel",disableWheelZoom)}function injectFrame(e){"use strict";0===($iframe=$("#__acrobatDialog__")).length?null==e.cookieStatus?checkForThirdPartyCookiesStatus(t=>{createAndInjectIframe(e)}):createAndInjectIframe(e):"none"===$iframe.css("display")&&"visible"===e.frame_visibility?$iframe.css({display:"block"}):e.trefoilClick&&($(document).off("keydown",disableKeyZoom),$(document).off("mousewheel",disableWheelZoom),delete e.trefoilClick,$iframe.remove())}function injectPersistFrame(e){if("application/pdf"!==document.contentType)return;var t=e.base64PDF;delete e.base64PDF;var i="message="+encodeURIComponent(JSON.stringify(e));const o=GetMenuDimensions("persistent",e);o.width<=0||o.height<=0||(e.base64PDF=t,0===($newiframe=$("#__acrobatNewDialog__")).length?($newiframe=$("<iframe>").attr("id","__acrobatNewDialog__").css({border:"0px",position:"fixed",top:"150px",right:"15px",height:o.height+"px",width:o.width+"px",display:"block",margin:"auto"}).attr("src",chrome.extension.getURL("data/js/frameUI.html")+"?"+i).appendTo("html"),$(document).on("keydown",disableKeyZoom),$(document).on("mousewheel",disableWheelZoom)):e.trefoilClick&&($(document).off("keydown",disableKeyZoom),$(document).off("mousewheel",disableWheelZoom),delete e.trefoilClick,$iframe.remove()))}function createAndInjectFTEIframe(e){const t=GetMenuDimensions("fte",e);t.width<=0||t.height<=0||0===($fteIframe=$("#__acrobatFTEDialog__")).length&&checkForThirdPartyCookiesStatus(e=>{e&&($fteIframe=$("<iframe>")).attr("id","__acrobatFTEDialog__").css({border:"1px","z-index":2147483647,position:"fixed",top:"-8px",right:"5px",height:t.height+"px",width:t.width+"px",display:"block",margin:"auto"}).attr("src",chrome.extension.getURL("data/js/viewer/journey/popup.html")).appendTo("html")})}function errorOpeningPDF(e){e.panel_op="status",e.current_status="pdf_failure",e.main_op="open_in_acrobat",sendMsg(e)}function downloadAuthenticatedPDF(e){var t=new XMLHttpRequest;t.open("GET",e.url,!0),t.responseType="blob",t.onerror=function(t){errorOpeningPDF(e)},t.onload=function(i){var o;t.status<400&&(e.url===t.responseURL||"application/pdf"===t.response.type)?((o=new FileReader).onloadend=function(t){e.base64PDF=t.target.result,e.content_op="status",e.current_status="pdf_downloaded",e.main_op="open_in_acrobat",sendMsg(e)},o.readAsDataURL(t.response)):errorOpeningPDF(e)},t.send()}function handler(e){"use strict";if(e&&"check_cookie_settings"===e.content_op&&(delete e.content_op,checkForThirdPartyCookiesStatus()),!e.authenticatedPDF||1!=e.authenticatedPDF||"pdf_downloading"!==e.current_status){if("dismiss"===e.content_op)if(delete e.content_op,1==e.fteUI||1==e.trefoilClick){if(delete e.fteUI,$fteIframe)return $(document).off("keydown",disableKeyZoom),$(document).off("mousewheel",disableWheelZoom),$fteIframe.remove(),void($fteIframe=null)}else if(1==e.trefoilUI||1==e.trefoilClick){if(delete e.trefoilUI,$iframe)return $(document).off("keydown",disableKeyZoom),$(document).off("mousewheel",disableWheelZoom),$iframe.remove(),void($iframe=null)}else if(1==e.newUI){if(delete e.newUI,$newiframe)return $(document).off("keydown",disableKeyZoom),$(document).off("mousewheel",disableWheelZoom),$newiframe.remove(),void($newiframe=null)}else if(null!=e.frictionless_workflow&&(delete e.frictionless_workflow,$iframe))return $(document).off("keydown",disableKeyZoom),$(document).off("mousewheel",disableWheelZoom),$iframe.remove(),void($iframe=null);if(e.panel_op)if($fteIframe&&$fteIframe.remove(),"load-frictionless"===e.panel_op&&e.pdf_action)if("resize_window"===e.content_op){const t=e.window_height;delete e.content_op,delete e.window_height,t&&$iframe&&$iframe.height(t+7)}else injectFrame(e);else 1==e.trefoilClick?(delete e.trefoilUI,delete e.newUI,injectFrame(e)):"FTE"===e.panel_op&&"FTE"===e.fte_op?(delete e.fte_op,createAndInjectFTEIframe(e)):1==e.newUI||1==e.persist?(delete e.newUI,delete e.trefoilUI,injectPersistFrame(e)):0==e.version||1==e.version&&1!=e.NMHConnStatus||injectFrame(e);return!1}downloadAuthenticatedPDF(e)}isSupportedBrowserVersion()&&isGoogleQuery(docUrl)&&sendMsg({main_op:"html-startup",url:document.location.href,startup_time:Date.now()}),disableKeyZoom=function(e){"use strict";e.ctrlKey&&-1!==[187,189,107,109].indexOf(e.keyCode)&&e.preventDefault()},disableWheelZoom=function(e){"use strict";e.ctrlKey&&e.preventDefault()},void 0!==chrome.runtime&&chrome.runtime.onMessage.addListener(handler);